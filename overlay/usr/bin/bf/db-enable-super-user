#!/usr/bin/nu

use bf
use bf-mariadb db root
bf env load -x

# Give the application user super permissions, to all databases and user management
export def main []: nothing -> nothing {
    let user = bf env DB_USERNAME
    let pass = bf env DB_PASSWORD
    let sql = $"GRANT ALL PRIVILEGES ON *.* TO '($user)'@'%' IDENTIFIED BY '($pass)' WITH GRANT OPTION;"
    let on_success = {|| bf write ok $"($user) now has permissions to access all databases and manage users." }
    { echo $sql | ^mariadb ...(root) } | bf handle -s $on_success db-enable-super-user
}
